---
title: The Test Boundary
date: 2023-08-27 15:20:00 +/-0
categories: [clean_architecture]
tags: [clean_architecture.clean_architecture-chp28] # TAG names should always be lowercase
---

테스트는 시스템의 일부이며, 아키텍처에도 관여한다.

# 시스템 컴포넌트인 테스트

아키텍처 관점에서는 TDD, BDD, Unit 등 모든 테스트가 동등하다.  
테스트는 태생적으로 세부적이며 구체적인 것으로 시스템 내부의 어떤 것도 테스트에 의존하지 않는다.  
테스트는 가장 바깥쪽 layer로 생각할 수 있으며 시스템 컴포넌트 중 가장 고립되어 있기에 독립적으로 배포가 가능하다.

테스트는 개발을 지원하는 역할이기에 시스템 운영에 꼭 필요치는 않지만 모든 시스템 컴포넌트가 반드시 지켜야 하는 모델을 표현해준다는 점에서 중요하다.

# 테스트를 고려한 설계

시스템에 강하게 결합된 테스트라면 시스템이 변경될 때 함께 변경되어야만 한다. 그럼 시스템에서 아주 작은 변경도 이와 결합된 수많은 테스트를 망가뜨릴 수 있다.  
약간의 수정으로 인해 깨지기 쉬운 테스트는 시스템을 뻣뻣하게 만든다는 부작용을 낳을 때가 많다. 따라서 이를 해결하기 위해 설계할 때 테스트를 고려해야 한다.

소프트웨어 설계의 첫 번째 규칙은 **변동성이 있는 것에 의존하지 말라**이다.  
GUI는 변동성이 크기에 GUI로 시스템을 조작하는 테스트 suite는 분명 깨지기 쉽다. 따라서 테스트를 설계할 때 GUI를 사용하지 않고 업무 규칙을 테스트할 수 있게 해야 한다.

# 테스트 API

이 목표를 달성하려면 테스트가 모든 업무 규칙을 검증하는 데 사용할 수 있도록 특화된 API를 만들면 된다.  
이 API는 보안 제약사항을 무시할 수 있고 DB와 같은 비싼 자원은 건너뛰고, 시스템을 테스트 가능한 특정 상태로 강제하는 강력한 힘을 가져야 한다.

테스트 API는 단순히 테스트를 UI에서 분리하는 것만이 아닌, 테스트 구조를 app 구조로부터 결합을 분리하는 게 목표다.

## 구조적 결합

테스트 API 역할은 app의 구조를 테스트로부터 숨기는 데 있다. 이렇게 하면 코드를 리팩터링하거나 진화하여도 테스트에는 전형 영향을 주지 않고 반대로 테스트를 수정해도 코드에 영향을 주지 않는다.

시간이 지날수록 테스트는 더 구체적이고 더 특화된 형태로 변할 것이고, 코드는 더 추상적이고 더 범용적인 형태로 변할 것이기에 이처럼 따로따로 진화할 수 있다는 점은 필수적이다.

## 보안

테스트 API가 지닌 강력한 힘을 운영 시스템에 배포하면 위험할 수 있기에 테스트 API 자체와 테스트 API 중 위험한 구현부는 독립적으로 배포할 수 있는 컴포넌트로 분리해야 한다.

# 결론

테스트는 시스템의 일부이기에 테스트로부터 기대하는 안정성과 회귀의 이점을 얻을 수 있으려면 테스트를 잘 설계해야 한다.  
따라서 테스트를 시스템의 일부로 설계하여 이를 유지보수하기 쉽게 한다.
