---
title: Understanding Data Types
date: 2023-08-22 20:10:00 +/-0
categories: [rds]
tags: [practical-sql-chp4] # TAG names should always be lowercase
image: ../../assets/practical-sql/practical-sql.jpeg
---

## Understanding Data Types

가장 많이 접하게 될 데이터 타입은 아래 세 가지이다.

- 문자: 글자와 기호
- 숫자: 정수와 소수를 포함한 모든 수
- 날짜와 시간: 시간 정보

### 문자형 데이터 타입 이해하기

- char(n)
  각 행에 n자만 보관하며 이보다 적게 입력 시 나머지 공간을 공백으로 채운다.
  표준 SQL의 일부인 이 데이터 타입으로 요즘에는 거의 쓰이지 않는다.
- varchar(n)
  최대 길이가 n으로 정의되는 가변 길이 데이터 타입이다. 최대치보다 적은 경우 공백을 추가하지 않는다.  
   이 타입 역시 표준 SQL에 포함되어 있다.
- text
  길이 제한이 없는 가변 길이 데이터 타입을 담는다.(PostgreSQL 문서에 따르면 최대 1GB 크기까지 가능하다.)  
   표준 SQL에 포함되지 않는다.

char을 통해 동일한 길의 글자를 담도록 정의해 어떤 데이터를 입력해야 하는지 쉽게 알 수 있을 경우에만 사용한다.  
책에서는 text 타입을 통해 최대 길이를 지정하지 않아 데이터 유연성을 확보하는 것을 추천한다.

### 숫자형 데이터 타입 이해하기

- 정수: 양수와 음수를 포함한 정수
- 고정 소수점과 부동 소수점: 실수를 표현하는 두 가지 형태

#### 정수

| 데이터 타입 | 크기   | 범위                                       |
| ----------- | ------ | ------------------------------------------ |
| smallint    | 2 byte | -32768 ~ 32767                             |
| int         | 4 byte | -2147483648 ~ 2147483647                   |
| bigint      | 8 byte | -9223372036854775808 ~ 9223372036854775807 |

입력되는 데이터 값의 범위를 알면 그에 맞춰 타입을 선언한다.(공간을 효율적으로 활용 가능)  
만약 확실하지 않은 경우 웬만한 조건을 모두 만족시킬 수 있는 bigint를 고려해보자.

#### 자동 증가 정수

테이블에 행을 추가할 때 자동 증가 정수를 포함하는 열을 만들면 각 행에 고유한 ID 번호를 만들어 이를 primary key로 활용할 수 있다.  
PostgreSQL에서는 serial 타입과 IDENTITY keyword(표준)을 통해 이를 정의할 수 있다.

IDENTITY의 경우 해당 열에 값을 삽입하지 않도록 방지가 가능하지만 serial의 경우 삽입이 가능하기에 IDENTITY 타입을 선호한다.  
IDENTITY를 사용하는 방법 2가지:

- GENERATED ALWAYS AS IDENTITY: 해당 열에 항상 자동 증가 정수를 삽입하며, 사용자는 해당 설정을 수동으로 재정의하지 않는 이상 삽입 불가능하다.
- GENERATED BY DEFAULT AS IDENTITY: 해당 열에 사용자가 값을 제공하지 않는 경우 기본적으로 자동 증가 정수를 삽입한다. 이 경우 값이 중복될 수 있기에 primary key로 사용하면 문제가 될 수 있다.

### 고정 소수점과 부동 소수점

| 데이터 타입      | 크기   | 저장 방식   | 범위                                        |
| ---------------- | ------ | ----------- | ------------------------------------------- |
| numeric, decimal | 가변적 | 고정 소수점 | 소수점 앞 131072 숫자, 소수점 뒤 16383 숫자 |
| real             | 4 byte | 부동 소수점 | 소수점 뒤 6 숫자                            |
| double precision | 8 byte | 부동 소수점 | 소수점 뒤 15 숫자                           |

고정 소수점의 경우 numberic(precision, scale) 형태로 선언한다. precision은 입력될 숫자의 전체 자릿수를, scale은 소수점 아래 자릿수를 적는다.  
부동 소수점은 '부정확'하기에 정확한 연산이 필요한 경우 항상 고정 소수점을 사용한다.

### 필요한 숫자 데이터 타입 선택하는 법

- 가능하다면 정수를 쓴다.
- 소수점 데이터를 다루는데 계산이 정확해야 한다면 numberic/decimal을 사용한다. 부동 소수점 타입은 공간을 절약할 수 있지만 계산의 정확도가 떨어진다. 만약 부동 소수점을 사용할 경우에는 정확도가 중요하지 않을 때만 사용한다.
- 충분히 큰 숫자 타입을 고른다. 몇 십만 개의 행을 담는 DB를 사용하지 않는 이상 큰 숫자 타입을 활용하는 편이 좋다.  
   numeric/decimal을 사용할 경우 precision을 충분히 크게 설정해 소수점 위/아래가 다 담길 수 있도록 공간을 확보하는게 좋다.  
   정수는 bigint를 사용하되, 열 값이 그보다 더 작은 타입에 무조건적으로 들어 맞을 것 같다는 확신이 있으면 더 작은걸 사용한다.

### 날짜와 시간 타입 이해하기

언제 어떤 일이 발생했는지는 누가, 무엇을, 얼마나 많은 사람이 참여했는지 만큼이나 데이터를 사용한 스토리텔링에 필수적이다.

| 데이터 타입 | 크기    | 저장 방식         |
| ----------- | ------- | ----------------- |
| timestamp   | 8 byte  | 날짜와 시간       |
| date        | 4 byte  | 날짜(시간 미포함) |
| time        | 8 byte  | 시간(날짜 미포함) |
| interval    | 16 byte | 시간 차이         |

- timestamp: 추적할 수 있는 다양한 상황에서 유용한 날짜와 시간을 기록한다.  
   해당 이벤트가 발생한 time zone이 포함되도록 keyword를 추가하는 것이 좋다. 그렇지 않으면 전 세계 여러 곳에서 기록된 시간을 비교할 수 없기 때문이다.  
   timestamp with time zone 타입은 표준 SQL의 일부이다.
- date: 날짜만 기록하며, SQL 표준의 일부이다.
- time: 시간만 기록하며, SQL 표준의 일부이다.
- interval: 기간의 시작과 끝을 기록하지 않고 오직 길이만 기록한다. 일반적으로 다른 날짜나 시간 열의 계산 또는 필터링에 사용한다.

```sql
SELECT
    timestamp_column,
    interval_column,
    timestamp_column - interval_column AS new_date
FROM date_time_types;
```

각 행에서 나오는 날짜로부터 interval 데이터 타입으로 표시된 시간 단위를 빼어 new_date를 추가됨을 확인할 수 있다.

### JSON과 JSONB 이해하기

JSON은 key/value 쌍과 목록의 컬렉션으로 정보를 구성한다.

- JSON: JSON 텍스트를 그대로 저장
- JSONB: JSON 텍스트를 Binary 형식으로 변환해 저장

jsonb의 경우 indexing을 지원하기에 처리 속도가 더 빠르다.

### 그 외 타입

- Boolean
- geometric: 점,선,원 및 기타 2차원 개체를 포함한다.
- text search: PostgreSQL 전문 검색 엔진용 텍스트 검색 타입이다.
- network address: IP 또는 MAC 주소와 같은 것들을 저장한다.
- UUID(Universal Unique Identifier): 경우에 따라 테이블의 고유 키로 사용된다.
- range: 정수 또는 timestamp 같은 값의 범위를 지정한다.
- binary 데이터를 저장하는 타입
- XML 및 JSON 타입

이 타입들은 책의 실습을 진행하며 살펴 볼 것이다.

### CAST를 통해 데이터 타입 변화하기

CAST()는 대상 데이터 타입이 원래 값을 수용할 수 있을 때만 성립한다. 문자 타입에는 숫자가 포함될 수 있기 때문에 정수를 텍스트로 변환하는 것이 가능하다.  
하지만 문자나 텍스트를 숫자로 변환할 수는 없다.

```sql
SELECT numeric_column,
CAST(numeric_column AS integer),
CAST(numeric_column AS text)
FROM number_data_types;
```

CAST 단축 표기법으로 ::을 사용할 수 있다. 이는 PostgreSQL 전용이라는 것을 명심한다.

```sql
SELECT numeric_column::varchar(10)
FROM number_data_types;
```
