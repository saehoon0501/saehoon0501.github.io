---
title: The Database Is a Detail
date: 2023-08-28 17:00:00 +/-0
categories: [clean_architecture]
tags: [clean_architecture.clean_architecture-chp30] # TAG names should always be lowercase
---

데이터베이스는 데이터에 접근할 방법을 제공하는 유틸리티로, 일개 소프트웨어일 뿐이다.
아키텍처 관점에서는 이러한 유틸리티는 저수준 세부사항(메커니즘)일 뿐이라서 아키텍처와 관련이 없다.  
따라서 아키텍처에서 중요한 데이터의 구조와 다르게 취급해야 한다.

# RDMS

관계형 테이블은 특정한 형식의 데이터에 접근하는 경우에는 편리하지만, 데이터를 테이블의 행 단위로 배치한다는 자체는 아키텍처적으로 볼 때 전혀 중요하지 않다. 데이터가 테이블 구조를 가진다는 사실은 오직 아키텍처의 외부 원에 위치한 최하위 수준의 유틸리티 함수만 알아야 한다.

많은 데이터 접근 프레임워크에서 테이블과 행이 객체 형태로 시스템에 돌아다니게 허용하는데, 이는 UseCase, Business Rule 심지어 UI조차 관계형 데이터 구조에 결합되기에 아키텍처적으로 잘못된 설계다.

# 데이터베이스 시스템은 왜 이렇게 널리 사용되는가?

## 디스크 원리

바로 'Disk' 때문이다.  
디스크에서 데이터는 원핵 트랙(track)에 저장되는데, 트랙은 섹터(sector)로 분할되고, 각 섹터는 사용하기 편한 바이트(주로 4kb)를 저장한다.  
디스크에서 특정 byte를 읽으려면, 헤드(head)를 적절한 트랙으로 옮기고, 디스크가 돌면서 헤드 위치에 적절한 섹터가 올 때까지 기다린 후, 해당 섹터에서 4kb 모두를 RAM으로 읽어야 한다. 그리고 RAM의 index를 찾아서 필요한 byte를 가져온다.

## 데이터 접근/관리 시스템의 필요성

위 과정은 ms 단위의 시간이 걸리지만 이는 cpu clock cycle과 비교하면 백만 배나 오래 걸리는 과정이다.  
따라서 latency를 완화하기 위해 index, cache, query 계획 최적화가 필요했고 이를 위해 데이터를 표현하는 표준 방식도 필요했다.
즉, 데이터 접근 및 관리 시스템이 필요했고 이는 FS(File System)과 RDMS 두 유형으로 분리된다.

## 두 가지 유형

FS는 문서(document)기반으로 문서를 이름을 기준으로 저장하거나 조회하는 경우 잘 작동하지만, 내용을 기준으로 검색할 때는 그리 큰 도움이 되지 않는다.  
RDMS는 내용 기반이다. 내용을 기반으로 레코드를 자연스럽고 편리하게 찾는 방법을 제공한다. 레코드가 서로 공유하는 일부 내용에 기반해서 다수의 레코드를 연관 짓는 데 매우 탁월하지만 정형화되지 않은 문서를 저장하고 검색하는 데는 부적합하다.

두 시스템 모두 데이터를 디스크에 체계화해서, 각 시스템에 특화된 방식으로 접근해야 할 때 가능한 효율적으로 데이터를 저장하고 검색할 수 있도록 한다. 각 시스템은 데이터를 indexing하고 배치하는 고유한 전략을 활용하며 결과적으로 데이터를 RAM으로 가져온다.

# 디스크가 없다면 어떻게 될까?

만약 디스크가 모두 사라진다면, 그래서 모든 데이터가 RAM에 저장된다면 데이터를 어떻게 체계화 할까?  
FS, RDMS 방식은 모두 사라지고 데이터들을 Data Structure(Linked List, Tree, Hash Table, Stack, Queue)등의 형태로 체계화할 것이며, 데이터가 접근할 때 포인터나 참조를 사용할 것이다. 이게 프로그래머가 하는 일이기 때문이다.

사실 FS,RDMS가 있더라도 우리는 이미 RAM으로 읽어드린 데이터들을 다루기 편한 Data Structure로 변경하고 있다.

# 세부사항

DB가 세부사항이라고 말하는 이유는 위에 다 나와있다.  
DB는 그저 메커니즘에 불과하며 아키텍처 관점에서는 저장된 데이터가 어떤 형태인 디스크 자체가 존재한다는 사실조차도 인식해서는 안 된다.

# 하지만 성능은?

DB 측면에서의 성능은 완전히 캡슐화되어 Business Rule과는 분리될 수 있는 관심사이다.  
이러한 저수준에서의 성능은 시스템의 아키텍처와는 아무런 관련이 없다.

# 결론

체계화된 데이터 구조와 데이터 모델 <--------> 데이터를 회전식 디스크 표면에서 옮길 뿐인 기술  
전자는 아키텍처적으로 중요하며, 후자는 세부 사항이다. 그리고 DB는 후자에 속하기에 세부사항이다.
